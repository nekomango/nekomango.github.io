<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©è¯ç¶²ç”¨é›»è¿½è¹¤ç³»çµ±</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
<header>
    <h1>ç‰©è¯ç¶²ç”¨é›»è¿½è¹¤ç³»çµ±</h1>
</header>

<main>

    <div class="date">
        <p>2025 / 5 / 14</p>
    </div>
    <section class="stats">
        <div>
            <p>æœ¬æœˆè€—é›»é‡</p>
            <h3 id="month-consumption">0 kWh</h3>
        </div>
        <div>
            <p>ä»Šæ—¥è€—é›»é‡</p>
            <h3 id="day-consumption">0 kW</h3>
        </div>
        <div>
            <p>é ä¼°æœ¬æœˆé›»è²»</p>
            <h3 id="bill">0 NTD</h3>
        </div>
    </section>

    <section class="warning">
        <div>
            <p>âš  ç©ºèª¿ - é•·æ™‚é–“é‹è¡Œ</p>
            <h3>ç©ºèª¿å·²æŒçºŒé‹è¡Œ8å°æ™‚ä»¥ä¸Šï¼Œå»ºè­°é—œé–‰æˆ–æé«˜æº«åº¦</h3>
        </div>
    </section>
    <section class="warning">
        <div>
            <p>âš  å†°ç®± - ç•°å¸¸é«˜è€—é›»</p>
            <h3>å†°ç®±çš„ç”¨é›»é‡æ˜é¡¯é«˜æ–¼å¹³å¸¸ï¼Œå»ºè­°æª¢æŸ¥æ˜¯å¦é—œé–‰ä¸åš´æˆ–æ˜¯å¦æœ‰å•é¡Œ</h3>
        </div>
    </section>

    <button class="collapsible">ä»Šæ—¥ç”¨é›»è¶¨å‹¢</button>
    <div class="collapsible-content">
        <section class="chart-container">
            <canvas id="electricityChart"></canvas>
        </section>
    </div>

    <button class="collapsible">å„é›»å™¨ç”¨é›»é‡</button>
    <div class="collapsible-content">
        <section class="devices">
            <div>
                <p>é›»è…¦ ğŸ¥‡</p>
                <h3 id="device6-usage">0 kW</h3>
            </div>
            <div>
                <p>ç©ºèª¿ ğŸ¥ˆ</p>
                <h3 id="device1-usage">0 kW</h3>
            </div>
            <div>
                <p>å†°ç®± ğŸ¥‰</p>
                <h3 id="device2-usage">0 kW</h3>
            </div>
            <div>
                <p>æ´—è¡£æ©Ÿ</p>
                <h3 id="device3-usage">0 kW</h3>
            </div>
            <div>
                <p>ç†±æ°´å™¨</p>
                <h3 id="device5-usage">0 kW</h3>
            </div>
            <div>
                <p>ç‡ˆå…·</p>
                <h3 id="device4-usage">0 kW</h3>
            </div>         
        </section>
    </div>

    <button class="collapsible">å„é›»å™¨ç”¨é›»æ¯”ä¾‹</button>
    <div class="collapsible-content">
        <section class="chart-container">
            <canvas id="deviceChart"></canvas>
        </section>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
    // ç”¨é›»è³‡æ–™
    const electricityData = {
        month_consumption: 124.3,  // å–®ä½ï¼škWh
        day_consumption: 7.08,  // å–®ä½ï¼škWh
        bill: 620.15,  // å–®ä½ï¼šNTD
        hourlyData: [0.3, 0.25, 0.15, 0.48, 0.6, 0.75, 0.8, 1.05, 0.9, 0.8, 1],  // æ¯å°æ™‚ç”¨é›»é‡
        devices: {
            airConditioner: 1.4,  // ç©ºèª¿
            fridge: 1.38,  // å†°ç®±
            washingMachine: 0.7,  // æ´—è¡£æ©Ÿ
            lights: 0.3,  // ç‡ˆå…·
            heater: 0.5, // ç†±æ°´å™¨
            computer: 2.7 // é›»è…¦
        }
    };

    // æ›´æ–°çµ±è¨ˆæ•¸æ“š
    document.getElementById('month-consumption').innerText = electricityData.month_consumption + " kWh";
    document.getElementById('day-consumption').innerText = electricityData.day_consumption + " kWh";
    document.getElementById('bill').innerText = electricityData.bill + " NTD";

    // æ›´æ–°é›»å™¨ç”¨é›»é‡
    document.getElementById('device1-usage').innerText = electricityData.devices.airConditioner + " kW";
    document.getElementById('device2-usage').innerText = electricityData.devices.fridge + " kW";
    document.getElementById('device3-usage').innerText = electricityData.devices.washingMachine + " kW";
    document.getElementById('device4-usage').innerText = electricityData.devices.lights + " kW";
    document.getElementById('device5-usage').innerText = electricityData.devices.heater + " kW";
    document.getElementById('device6-usage').innerText = electricityData.devices.computer + " kW";

    // ç¹ªè£½ç”¨é›»è¶¨å‹¢åœ–è¡¨
    const ctx = document.getElementById('electricityChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
            datasets: [{
                label: 'æ¯å°æ™‚ç”¨é›»é‡ (kWh)',
                data: electricityData.hourlyData,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: true
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // ç¹ªè£½é›»å™¨ç”¨é›»æ¯”ä¾‹åœ–è¡¨
    const deviceCtx = document.getElementById('deviceChart').getContext('2d');
    const deviceChart = new Chart(deviceCtx, {
        type: 'pie',
        data: {
            labels: ['ç©ºèª¿', 'å†°ç®±', 'æ´—è¡£æ©Ÿ', 'ç‡ˆå…·','ç†±æ°´å™¨','é›»è…¦'],
            datasets: [{
                label: 'ç”¨é›»é‡ (kW)',
                data: [
                    electricityData.devices.airConditioner,
                    electricityData.devices.fridge,
                    electricityData.devices.washingMachine,
                    electricityData.devices.lights,
                    electricityData.devices.heater,
                    electricityData.devices.computer
                ],
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4CAF50', '#2e8f4c', '#4103fc'],
                hoverOffset: 6
            }]
        },
        options: {
        plugins: {
            datalabels: {
                color: '#fff',  // æ¨™ç±¤æ–‡å­—é¡è‰²
                formatter: (value, context) => {
                    let total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                    let percentage = (value / total * 100).toFixed(1);  // è¨ˆç®—ç™¾åˆ†æ¯”ä¸¦ä¿ç•™ä¸€ä½å°æ•¸
                    let label = context.chart.data.labels[context.dataIndex];
                    return label + ":\n" + percentage + '%';  // é¡¯ç¤ºç™¾åˆ†æ¯”
                },
                font: {
                    weight: 'bold',
                    size: 14
                }
            }
        }
    },
    plugins: [ChartDataLabels]  // å•Ÿç”¨ ChartDataLabels æ’ä»¶
    });

    // ä¼¸ç¸®æ•ˆæœè…³æœ¬
    const collapsibles = document.getElementsByClassName("collapsible");
    for (let i = 0; i < collapsibles.length; i++) {
        collapsibles[i].addEventListener("click", function() {
            this.classList.toggle("active");
            const content = this.nextElementSibling;
            if (content.style.display === "block") {
                content.style.display = "none";
            } else {
                content.style.display = "block";
            }
        });
    }
</script>

</body>
</html>